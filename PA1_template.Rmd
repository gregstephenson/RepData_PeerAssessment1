---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: yes
---
```{r include=FALSE}
knitr::opts_chunk$set(scipen=100,fig.width=12, fig.height=8, fig.path='Figs/',
                      echo=TRUE, warning=FALSE, message=FALSE)
options(scipen = 999, digits=2)
```

## Loading and preprocessing the data

```{r}
rawData = read.csv("activity.csv", header = TRUE)
hours <- as.integer(rawData[,"interval"] / 100)
minutes <- rawData[,"interval"] %% 100
decimalMinutes <- minutes/60
continuousTime <- hours + decimalMinutes
```

## What is mean total number of steps taken per day?

```{r echo = TRUE, results="asis"}
totalDailySteps = aggregate(. ~date, data=rawData, sum, na.rm=TRUE)
hist(totalDailySteps[,"steps"], plot = TRUE, breaks = 20, main = "Histogram of Total Daily Steps", col = "lightblue", xlab = "Total Steps per Day")
averageStepsPerDay = mean(totalDailySteps[,"steps"])
medianStepsPerDay = median(totalDailySteps[,"steps"])
```
The mean total number of steps taken per day is `r averageStepsPerDay`. The median is `r medianStepsPerDay`.


## What is the average daily activity pattern?
```{r echo = TRUE}
library(ggplot2)
meanStepsPerInterval <- aggregate(. ~interval, data=rawData, mean, na.rm=TRUE)
meanStepsPerInterval$continuousTime <- continuousTime[1:nrow(meanStepsPerInterval)]
ggplot(meanStepsPerInterval, aes(continuousTime, steps)) + geom_line() + xlab("Time Interval (24hr Time)") + ylab("Average Steps") + ggtitle("Daily Activity Pattern")
maximumSteps <- max(meanStepsPerInterval$steps)
maximumStepsInterval <- meanStepsPerInterval$interval[which.max(meanStepsPerInterval$steps)]
```
The data shows the greatest average activity between 07:30 and 10 am, with a peak of `r maximumSteps` in the 5 minutes following `r maximumStepsInterval`.

## Imputing missing values
In order to estimate the values that are missing, I have decided to make the assumption that this person maintains a very consistent daily routine, and simply use the average number of steps for that time interval to replace the missing value.
```{r}
backFilledData <- read.csv("activity.csv", header = TRUE)
indexedList <- rep(meanStepsPerInterval, 61)


newTotalDailySteps = aggregate(. ~date, data=backFilledData, sum, na.rm=TRUE)
hist(newTotalDailySteps[,"steps"], plot = TRUE, breaks = 20, main = "Histogram of Total Daily Steps", col = "lightblue", xlab = "Total Steps per Day")
newAverageStepsPerDay = mean(newTotalDailySteps[,"steps"])
newMedianStepsPerDay = median(newTotalDailySteps[,"steps"])
```

Having replace all NAs in the data with the average number of steps taken in the same time interval, we find that the mean number of steps each day is now `r newAverageStepsPerDay` and the median has become `r newMedianStepsPerDay`. Tjhese values are extremely close to the original data.

## Are there differences in activity patterns between weekdays and weekends?

```{r}
days <- factor(weekdays(as.Date(backFilledData$date)))
levels(days) <- c("WeekDay","WeekDay","WeekEnd", "WeekEnd","WeekDay","WeekDay","WeekDay")
backFilledData$wd <- days
test <- split(backFilledData, backFilledData$wd)
WeekDays <- as.data.frame(test[1])
WeekEnds <- as.data.frame(test[2])

WDSPI <- aggregate(. ~WeekDay.interval, data=WeekDays, mean, na.rm=TRUE)
WDSPI$continuousTime <- continuousTime[1:nrow(WDSPI)]

WESPI <- aggregate(. ~WeekEnd.interval, data=WeekEnds, mean, na.rm=TRUE)
WESPI$continuousTime <- continuousTime[1:nrow(WESPI)]

p1 <- ggplot(WDSPI, aes(continuousTime, WeekDay.steps)) + geom_line() + xlab("Time Interval (24hr Time)") + ylab("Average Steps") + ggtitle("WeekDay Activity Pattern")
p2 <- ggplot(WESPI, aes(continuousTime, WeekEnd.steps)) + geom_line() + xlab("Time Interval (24hr Time)") + ylab("Average Steps") + ggtitle("WeekEnd Activity Pattern")

multiplot(p1, p2, cols=1)
```